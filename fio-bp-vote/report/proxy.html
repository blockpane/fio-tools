<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BP Rankings</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="bootstrap.css">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.18.1/dist/bootstrap-table.min.css">
</head>
<body>
        <div class="container-fluid">
            <div class="w-65 mx-auto"  style="max-width: 1200px;">
                <p>&nbsp;</p>
                <div class="h3">FIO Producer Ranking</div>
                <p>This is the current ranking for block producers on the FIO network.</p>
                <p>These rankings are generated by measuring performance, and participation in maintaining the network as measured by the <a href="https://github.com/blockpane/fio-tools/tree/master/fio-bp-vote">fio-bp-vote</a> utility. Maintenance includes updating fees to keep pricing at a reasonable level, participating in contract updates, and a series of maintenance calls that optimize state or trigger reward payouts</p>
                <p>Three criteria negatively affect ranking. <br/>&nbsp;▸ Slow CPU, currently this is defined by an average time to execute a transaction longer than 5,000µs. Producer CPU time is viewable <a href="https://graph.fioprotocol.io/d/6du4X1SGk/current-activity?orgId=1&refresh=1m&kiosk">on the FIO stats site.</a> <br/>&nbsp;▸ Never having claimed rewards results in a score of -100, since this indicates that the producer is not likely active. <br/>&nbsp;▸ Finally having no votes is an indicator that a producer is not active, and results in a score of -200, but if a registered producer has neither claimed or received votes they are not considered at all</p>
                <p>These rankings are used by two proxies: <a href="https://fio.bloks.io/account/top21p21aion">proxy@blockpane</a> (voting for Top 21 by rank,) and <a href="https://fio.bloks.io/account/top15cef5xvc">vote@blockpane</a> (voting for Top 15 by rank.) Votes are calculated at least once a day. In the case that a block producer is missing full rounds, their votes are withdrawn. The rankings shown on this page include all registered producers. This does not represent the list used by the @blockpane proxy voters, there is additional criteria that 1) the producers have listed publicly available API and P2P endpoints in the <a href="http://github.com/fioprotocol/fio.mainnet">fio.mainnet</a> list. 2) Those nodes are functional according to the <a href="http://health.fioprotocol.io">FIO health dashboard</a>.</p>
                <p id="last_updated"></p>
                <table id="table" class="table-hover table-sm table-borderless" data-toggle="table" data-flat="true" data-url="ranks.json" data-card-view="false">
                    <thead>
                    <tr>
                        <th data-align="right" data-field="address" data-formatter="linkFormatter">Producer</th>
                        <th data-align="center" data-field="svg" data-formatter="svgFormatter"></th>
                        <th data-align="center" data-field="missing_excluded" data-formatter="boolInvertedFormatter"></th>
                        <th data-align="center" data-field="score" data-cell-style="scoreFormatter">Score</th>
                        <th data-align="center" data-field="fee_vote_30d" data-cell-style="cellStyle">Fee</th>
                        <th data-align="center" data-field="msig_30d" data-cell-style="cellStyle">MSig</th>
                        <th data-align="center" data-field="bpclaim_1d" data-cell-style="cellStyle">Claim</th>
                        <th data-align="center" data-field="tpidclaim_1d" data-cell-style="cellStyle">tpidclaim</th>
                        <th data-align="center" data-field="compute" data-cell-style="cellStyle">computefees</th>
                        <th data-align="center" data-field="burnexpired_1d" data-cell-style="cellStyle">burnexpired</th>
                        <th data-align="center" data-field="cpu_score" data-cell-style="cellStyle">CPU</th>
                        <th data-align="center" data-field="diff_sign_key" data-formatter="boolFormatter">Key</th>
                        <th data-align="center" data-field="bp_json" data-formatter="boolFormatter">JSON</th>
                        <th data-align="center" data-field="bp_json_cors" data-formatter="boolFormatter">CORS</th>
                        <th data-align="center" data-field="valid_url" data-formatter="boolFormatter">Site</th>
                        <th data-align="center" data-field="using_linked_auth_or_msig" data-formatter="boolFormatter">Perms</th>
                        <th data-align="center" data-field="has_claimed_30d" data-formatter="boolFormatter">Active</th>
                    </tr>
                    </thead>
                </table>
                <p>&nbsp;</p>
                <div class="w-65"  style="max-width: 1000px;">
                <p>Legend</p>
                <div class="row">
                    <div class="col-2 h6 text-xl-right">Fee:</div>
                    <div class="col-8 font-italic">Fee votes in last 30 days. 1 point (max 60.)</div>
                </div>
                <div class="row">
                    <div class="col-2 h6 text-xl-right text-xl-right">MSig:</div>
                    <div class="col-8 font-italic">Multi-sig participation in last 30 days. 10 points for each approve/propose/exec.</div>
                </div>
                <div class="row">
                    <div class="col-2 h6 text-xl-right">Claim:</div>
                    <div class="col-8 font-italic">BP Rewards claimed last 1 day. 1 point.</div>
                </div>
                <div class="row">
                    <div class="col-2 h6 text-xl-right">tpidclaim:</div>
                    <div class="col-8 font-italic">Called tpidclaim (maintenance call) last 1 day. 1 point.</div>
                </div>
                    <div class="row">
                        <div class="col-2 h6 text-xl-right">computefees:</div>
                        <div class="col-8 font-italic">Called computefees (maintenance call) last 1 day. 1 point.</div>
                    </div>
                <div class="row">
                    <div class="col-2 h6 text-xl-right">burnexpired:</div>
                    <div class="col-8 font-italic">Called burnexpired (maintenance call) last 1 day. 1 point.</div>
                </div>
                <div class="row">
                    <div class="col-2 h6 text-xl-right">CPU:</div>
                    <div class="col-8 font-italic">CPU performance penalty: negative 3 points, per each 1ms over 5ms avg</div>
                </div>
                <div class="row">
                    <div class="col-2 h6 text-xl-right">Key:</div>
                    <div class="col-8 font-italic">Signing key differs from account key (security best practice). 1 point.</div>
                </div>
                <div class="row">
                    <div class="col-2 h6 text-xl-right">JSON:</div>
                    <div class="col-8 font-italic">bp.json file was reachable based on URL in producer registration. 1 point.</div>
                </div>
                <div class="row">
                    <div class="col-2 h6 text-xl-right">CORS:</div>
                    <div class="col-8 font-italic">bp.json responds with permissive CORS. 1 point.</div>
                </div>
                <div class="row">
                    <div class="col-2 h6 text-xl-right">Site:</div>
                    <div class="col-8 font-italic">Website in bp.json exists. 1 point.</div>
                </div>
                <div class="row">
                    <div class="col-2 h6 text-xl-right">Perms:</div>
                    <div class="col-8 font-italic">Permissions on key delegate bpclaim (and others, security best practice). 1 point.</div>
                </div>
                <div class="row">
                    <div class="col-2 h6 text-xl-right">Active:</div>
                    <div class="col-8 font-italic">Has performed at least 1 bpclaim in last 30 days (false may indicate inactive producer). -100 points if no claims.
                    </div>
                </div>
                <div class="row">
                    <div class="col-2 h6 text-xl-right">🚫&nbsp;</div>
                    <div class="col-8 font-italic">Has missed at least one round in in last 3 evaluation cycles, and is excluded from ranking.</div>
                    </div>
                </div>
                    <p>&nbsp;</p>
                </div>
                <script>
                    function scoreFormatter(value, row) {
                        if (row.missing_excluded === true) {
                            return {
                                css: {
                                    color: 'black'
                                }
                            }
                        }
                        if (value > 100) {
                            return {
                                css: {
                                    color: 'green'
                                }
                            }
                        } else if (value > 50) {
                            return {
                                css: {
                                    color: '#dddddd'
                                }
                            }
                        } else if (value > 25) {
                            return {
                                css: {
                                    color: '#999999'
                                }
                            }
                        } else if (value > 0) {
                            return {
                                css: {
                                    color: '#555555'
                                }
                            }
                        }
                        return {
                            css: {
                                color: 'darkred'
                            }
                        }
                    }
                    let counter = 0
                    function linkFormatter(value, row) {
                        if (counter === 0) {
                            document.getElementById("last_updated").innerHTML = 'Last updated: ' + row.time;
                        }
                        let color = 'grey'
                        if (row.missing_excluded === true) {
                            color = "black"
                        } else if (counter < 15) {
                            color = '#00FFaa'
                        } else if (counter < 21) {
                            color = 'green'
                        }
                        let space = " &nbsp;"
                        if (counter >= 9) {
                            space = " "
                        }
                        counter++
                        return '<div class="font-weight-bolder" style="color: ' + color + '">' +
                        '<a target="bloks" href="https://fio.bloks.io/account/' + row.account + '"> ' + value + '</a> #' + space + counter +'</div>'
                    }
                    function cellStyle(value, row) {
                        if (row.missing_excluded === true) {
                            return {
                                css: {
                                    color: 'black'
                                }
                            }
                        }
                        if (value < 0) {
                            return {
                                css: {
                                    color: 'orange'
                                }
                            }
                        } else if (value > 30) {
                            return {
                                css: {
                                    color: '#00FFaa'
                                }
                            }
                        } else if (value > 0) {
                            return {
                                css: {
                                    color: 'white'
                                }
                            }
                        }
                        return {
                            css: {
                                color: 'black'
                            }
                        }
                    }
                    function boolInvertedFormatter(value, row) {
                        if (value) {
                            return '<div style="color: red">🚫</div>'
                        }
                        return ""
                    }
                    function svgFormatter(value) {
                        if (value.match('^https://[a-zA-Z0-9_/.-]+\.svg$')) {
                           return '<div style="background-color: #333333"><img height="20" width="20" src="' + value + '"/></div>'
                        }
                        return ''
                    }
                    function boolFormatter(value, row) {
                        if (row.missing_excluded === true) {
                            return '<div style="color: orange">-</div>'
                        }
                        let color = 'red'
                        let symbol = '𐄂';
                        if (value) {
                            color = 'green'
                            symbol = '✓'
                        }
                        return '<div style="color: ' + color + '">' +
                            symbol +
                            '</div>'
                    }
                </script>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/bootstrap-table@1.18.1/dist/bootstrap-table.min.js"></script>
</body>
</html>
